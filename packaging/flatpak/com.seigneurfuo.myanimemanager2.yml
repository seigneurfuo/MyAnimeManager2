app-id: com.seigneurfuo.myanimemanager2
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: /app/bin/MyAnimeManager2.py
#rename-desktop-file: myanimemanager2.desktop
#rename-icon: myanimemanager2

finish-args:
  - --filesystem=~/.myanimemanager2

  # X11/Wayland
  - --socket=x11  # show windows using X11
  - --share=ipc   # share IPC namespace with the host (necessary for X11)
  - --device=dri  # OpenGL rendering
  # Sync
  - --share=network

modules:
  - name: myanimenager2
    buildsystem: simple
    build-commands:
      - cp -R . /app/bin/

    sources:
      - type: git
        url: "file:///home/seigneurfuo/Projets/MyAnimeManager/MyAnimeManager 2"
        branch: master

  # ----- https://github.com/LukeBriggsDev/Pepys/blob/master/dev.lukebriggs.pepys.yml -----

  # For optional requirements
  # - python3-requirements.json

  - name: pyqt-deps
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=/app --root=/
    modules:
      - python3-PyQt-builder.json
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/b1/40/dd8f081f04a12912b65417979bf2097def0af0f20c89083ada3670562ac5/PyQt5_sip-12.9.0.tar.gz
        sha256: d3e4489d7c2b0ece9d203ae66e573939f7f60d4d29e089c9f11daa17cfeaae32

  - name: pyqt5
    build-options:
      env:
        - QMAKEPATH=/app/lib
      arch:
        aarch64:
          config-opts:
            - --disable-feature=PyQt_Desktop_OpenGL
    cleanup:
      - /share/sip
    config-opts:
      - --confirm-license
      - --no-designer-plugin
      - --no-qml-plugin
      - --no-python-dbus
      - --no-tools
      - --enable=QtCore
      - --enable=QtGui
      - --enable=QtNetwork
      - --enable=QtWidgets
      - --enable=QtWebChannel
      - --enable=QtPrintSupport
      - --bindir=/app/bin
      - --destdir=/app/lib/python3.8/site-packages
      - --sipdir=/app/share/sip/PyQt5
      - --stubsdir=/app/lib/python3.8/site-packages/PyQt5
      - QMAKE_CFLAGS_RELEASE='-I/usr/include/python3.8/'
      - QMAKE_CXXFLAGS_RELEASE='-I/usr/include/python3.8/'
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/8e/a4/d5e4bf99dd50134c88b95e926d7b81aad2473b47fde5e3e4eac2c69a8942/PyQt5-5.15.4.tar.gz
        sha256: 2a69597e0dd11caabe75fae133feca66387819fc9bc050f547e5551bce97e5be
      - type: script
        commands:
          - processed=`sed -e 's|prefix|sysroot|' <<< $@`
          - python3 configure.py $processed
        dest-filename: configure
